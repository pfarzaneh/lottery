# Lottery Service


### Build/Run Instruction

The Lottery Service is implemented using:
* Java 17
* Spring Boot 2.7.2
* Spring Data JPA
* H2 Embedded DB (Durable mode)
* Lombok
* Swagger 2

Domain model of Lottery System is shown below:

![Alt text](data-model.png?raw=true "Lottery Data Model")

The *H2 DB* is populated with some available data.

In the root directory of project run:

`mvn clean spring-boot:run`

After running the service, you can access the database 
by hitting:

[http://localhost:8080/lotteryDB](http://localhost:8080/lotteryDB)

Credentials for logging in:

```
JDBC URL:  jdbc:h2:file:./data/lotteryDB
User Name: root
Password:  RootPass
```

The implemented **Lottery Service** contains 8 Rest APIs 
which are documented by Swagger API documentation library. 
The implemented APIs can be accessed through:

[http://localhost:8080/swagger-ui.html](http://localhost:8080/swagger-ui.html)

Just as an example for reading all defined lotteries, 
you can call:

[http://localhost:8080/lottery?page=0&size=10](http://localhost:8080/lottery?page=0&size=10)

This API is documented under 
[lottery-controller](http://localhost:8080/swagger-ui.html#/lottery-controller).


### List of APIs 

[lottery-controller](http://localhost:8080/swagger-ui.html#/lottery-controller) contains:

1. Adding new lottery >> _POST: /lottery_
2. Reading all defined lotteries(with pagination) >> _GET: /lottery?page=0&size=10_
3. Finishing a lottery >> _PATCH: /lottery/{id}/finish_

[participant-controller](http://localhost:8080/swagger-ui.html#/participant-controller) contains:
4. Registering a user for a lottery >> _POST: /participant/register_
5. Read all active lotteries user registered for >> _GET: /participant/{ssn}/lotteries_
6. Submit as many ballots as user buys >> _POST: /participant/{ssn}/submit_
7. Read all ballots user submitted for a specific lottery >> _GET: /participant/{ssn}/lottery/{lotteryId}/ballots_

[winner-controller](http://localhost:8080/swagger-ui.html#/winner-controller) contains:
8. Read the detailed info of a winner for specific date >> _GET: /winner/of/{date}_


### Service Characteristics

* Having multi layer clean architecture following separation of concerns
* Clean distinction between domain models, entities and DTOs
* Implemented a basic exception handling(error message passing)
* Used Spring in-built Cron Job Scheduler for midnight operation
* Each ballot has a unique code which will be generated by a simple algorithm


### Possible Improvements

* Only users with right privilege should be able to define new lotteries 
* Using libraries like MapStruct to implement cleaner mappings between DTOs and domain Entities/Models
* Adding elaborate exception handling and message translation for clients
* Adding proper log mechanism
* Making API documentation more enriched
* Adding unit/integration tests to assure quality